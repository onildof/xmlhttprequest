<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>AJAX XMLHttpRequest encadeado em loop infinito</title>
    </head>
    <body>
        <h1>AJAX XMLHttpRequest encadeado em loop infinito</h1>
        <div id="output">Soma: 0</div>
        <div id="output2">Última: 0</div>
        <button id="load">load</button>
        
        <script>
            let output = document.querySelector("#output")
            let output2 = document.querySelector("#output2")
            let button = document.querySelector("#load")
            let soma = 0

            button.addEventListener("click", function () {
                consulta()
            })
            
            function consulta() {
                let xhr = new XMLHttpRequest()
                
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        atualizaPagina(xhr.response)
                        consulta()
                    }
                }
                
                xhr.open('GET', '/users', true)
                xhr.send()
            }
            
            function atualizaPagina(http_response) {
                let tempo = parseInt(http_response)
                
                soma += tempo
                output.innerHTML = "Soma: "+soma
                output2.innerHTML = "Última: "+tempo
            }
        </script>
    </body>
</html>